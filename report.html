
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>SQL Antipattern Scan Report</title>
            <link rel="stylesheet" href="report_styles.css">
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
            <style>
                .summary-box {
                    cursor: pointer;
                    border: 1px solid #ddd;
                    padding: 10px;
                    margin-bottom: 10px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                .toggle-icon {
                    transition: transform 0.3s ease;
                }
                .summary-box.active .toggle-icon {
                    transform: rotate(180deg);
                }
                .breakdown {
                    display: none;
                    margin-top: 10px;
                    padding: 10px;
                    border: 1px solid #ddd;
                    background-color: #f9f9f9;
                }
                .show {
                    display: block;
                }
            </style>
        </head>
        <body>
            <header>
                <h1>SQL Antipattern Scan Report</h1>
            </header>
            <main>
                <section class="summary-container">
                    <div class="summary-card">
                        <div class="summary-item">
                            <h2>Total Issues</h2>
                            <div class="summary-box" onclick="toggleBreakdown('total-issues-breakdown', this)">
                                <p class="large-number">9</p>
                                <span class="toggle-icon">&#9662;</span>
                            </div>
                            <div id="total-issues-breakdown" class="breakdown">
                                <h3>Total Issues Breakdown</h3>
                                <ul>
                                    
                                    <li>Critical: 2</li>
                                    
                                    <li>High: 2</li>
                                    
                                    <li>Medium: 4</li>
                                    
                                    <li>Low: 1</li>
                                    
                                </ul>
                            </div>
                        </div>
                        <div class="summary-item">
                            <h2>Severity Score</h2>
                            <div class="summary-box" onclick="toggleBreakdown('severity-score-breakdown', this)">
                                <p class="large-number">23</p>
                                <span class="toggle-icon">&#9662;</span>
                            </div>
                            <div id="severity-score-breakdown" class="breakdown">
                                <h3>Severity Score Breakdown</h3>
                                <ul>
                                    
                                    <li>Critical: 2 x 4 = 8</li>
                                    
                                    <li>High: 2 x 3 = 6</li>
                                    
                                    <li>Medium: 4 x 2 = 8</li>
                                    
                                    <li>Low: 1 x 1 = 1</li>
                                    
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="instructions">
                        Click on the boxes to view the breakdown.
                    </div>
                    <div class="chart-card">
                        <h2>Severity Distribution</h2>
                        <div class="chart-container">
                            <canvas id="severityChart"></canvas>
                        </div>
                    </div>
                </section>

                <section class="detailed-findings">
                    <h2>Detailed Findings</h2>
                    <div id="issuesList">
                    
                        
                        <details class="issue" data-severity="critical">
                            <summary>
                                <span class="issue-name">ANSI-89 Join</span>
                                <span class="severity critical">Critical</span>
                            </summary>
                            <div class="issue-details">
                                <p><strong>Description:</strong> Using outdated ANSI-89 join syntax instead of explicit JOIN clauses can lead to logical errors and reduced readability.</p>
                                <p><strong>Suggestion:</strong> Use explicit JOIN clauses instead of comma-separated table lists.</p>
                                <div class="code-block">
                                    <h4>Offending SQL:</h4>
                                    <pre><code>users u, orders o, products p</code></pre>
                                </div>
                                <div class="code-block">
                                    <h4>Context:</h4>
                                    <pre><code>SELECT *
FROM users u, orders o, products p
WHERE u.id = o.user_id
  AND o.product_id = p.id
  AND u.name </code></pre>
                                </div>
                                <div class="code-block">
                                    <h4>Remediation example:</h4>
                                    <pre><code>FROM table1 INNER JOIN table2 ON table1.id = table2.id</code></pre>
                                </div>
                            </div>
                        </details>
                        
                        <details class="issue" data-severity="critical">
                            <summary>
                                <span class="issue-name">NULL Comparison</span>
                                <span class="severity critical">Critical</span>
                            </summary>
                            <div class="issue-details">
                                <p><strong>Description:</strong> Incorrectly filtering for NULL using = or != instead of IS NULL or IS NOT NULL.</p>
                                <p><strong>Suggestion:</strong> Use IS NULL or IS NOT NULL for NULL comparisons.</p>
                                <div class="code-block">
                                    <h4>Offending SQL:</h4>
                                    <pre><code>status = NULL</code></pre>
                                </div>
                                <div class="code-block">
                                    <h4>Context:</h4>
                                    <pre><code>s o, products p
WHERE u.id = o.user_id
  AND o.product_id = p.id
  AND u.name LIKE '%john%'
  AND o.status = NULL
  AND p.price BETWEEN 100 AND 500
  AND o.id IN (SELECT id FROM abandoned_orders)
  AN</code></pre>
                                </div>
                                <div class="code-block">
                                    <h4>Remediation example:</h4>
                                    <pre><code>WHERE column IS NULL</code></pre>
                                </div>
                            </div>
                        </details>
                        
                    
                        
                        <details class="issue" data-severity="high">
                            <summary>
                                <span class="issue-name">ORDER BY RAND()</span>
                                <span class="severity high">High</span>
                            </summary>
                            <div class="issue-details">
                                <p><strong>Description:</strong> Using ORDER BY RAND() for random sorting is inefficient for large datasets.</p>
                                <p><strong>Suggestion:</strong> Consider alternative methods for random selection, such as using a subquery with LIMIT.</p>
                                <div class="code-block">
                                    <h4>Offending SQL:</h4>
                                    <pre><code>ORDER BY RAND()</code></pre>
                                </div>
                                <div class="code-block">
                                    <h4>Context:</h4>
                                    <pre><code>widget', 'gadget', 'gizmo')
  AND u.created_at > '2022-01-01'
GROUP BY 1, 2, 3
HAVING COUNT(*) > 10
ORDER BY RAND()
LIMIT 1000;</code></pre>
                                </div>
                                <div class="code-block">
                                    <h4>Remediation example:</h4>
                                    <pre><code>SELECT * FROM (SELECT * FROM table ORDER BY RAND() LIMIT 10) t ORDER BY id</code></pre>
                                </div>
                            </div>
                        </details>
                        
                        <details class="issue" data-severity="high">
                            <summary>
                                <span class="issue-name">Both-sided Wildcard</span>
                                <span class="severity high">High</span>
                            </summary>
                            <div class="issue-details">
                                <p><strong>Description:</strong> Using wildcards on both sides in LIKE conditions can lead to poor performance and ineffective index usage.</p>
                                <p><strong>Suggestion:</strong> Avoid using both leading and trailing wildcards in LIKE conditions. Consider full-text search for complex pattern matching.</p>
                                <div class="code-block">
                                    <h4>Offending SQL:</h4>
                                    <pre><code>LIKE '%john%'</code></pre>
                                </div>
                                <div class="code-block">
                                    <h4>Context:</h4>
                                    <pre><code> *
FROM users u, orders o, products p
WHERE u.id = o.user_id
  AND o.product_id = p.id
  AND u.name LIKE '%john%'
  AND o.status = NULL
  AND p.price BETWEEN 100 AND 500
  AND o.id IN (SELECT id FROM </code></pre>
                                </div>
                                <div class="code-block">
                                    <h4>Remediation example:</h4>
                                    <pre><code>Use a full-text search index or LIKE 'value%' if possible</code></pre>
                                </div>
                            </div>
                        </details>
                        
                    
                        
                        <details class="issue" data-severity="medium">
                            <summary>
                                <span class="issue-name">SELECT *</span>
                                <span class="severity medium">Medium</span>
                            </summary>
                            <div class="issue-details">
                                <p><strong>Description:</strong> Using SELECT * instead of specifying columns can lead to performance issues and make queries brittle to schema changes.</p>
                                <p><strong>Suggestion:</strong> Explicitly list the columns you need in the SELECT statement.</p>
                                <div class="code-block">
                                    <h4>Offending SQL:</h4>
                                    <pre><code>SELECT *</code></pre>
                                </div>
                                <div class="code-block">
                                    <h4>Context:</h4>
                                    <pre><code>SELECT *
FROM users u, orders o, products p
WHERE u.id = o.user_id
  AND o.product_id = p.id
  AND u.n</code></pre>
                                </div>
                                <div class="code-block">
                                    <h4>Remediation example:</h4>
                                    <pre><code>SELECT column1, column2, column3 FROM table</code></pre>
                                </div>
                            </div>
                        </details>
                        
                        <details class="issue" data-severity="medium">
                            <summary>
                                <span class="issue-name">Subquery in IN clause</span>
                                <span class="severity medium">Medium</span>
                            </summary>
                            <div class="issue-details">
                                <p><strong>Description:</strong> Using a subquery in an IN clause can be inefficient. Consider using EXISTS or JOIN instead.</p>
                                <p><strong>Suggestion:</strong> Replace IN (SELECT ...) with EXISTS or JOIN for better performance.</p>
                                <div class="code-block">
                                    <h4>Offending SQL:</h4>
                                    <pre><code>WHERE u.id = o.user_id
  AND o.product_id = p.id
  AND u.name LIKE '%john%'
  AND o.status = NULL
  AND p.price BETWEEN 100 AND 500
  AND o.id IN (SELECT id FROM abandoned_orders)
  AND LOWER(p.name) IN ('widget', 'gadget', 'gizmo')
  AND u.created_at > '2022-01-01'
</code></pre>
                                </div>
                                <div class="code-block">
                                    <h4>Context:</h4>
                                    <pre><code>SELECT *
FROM users u, orders o, products p
WHERE u.id = o.user_id
  AND o.product_id = p.id
  AND u.name LI</code></pre>
                                </div>
                                <div class="code-block">
                                    <h4>Remediation example:</h4>
                                    <pre><code>WHERE EXISTS (SELECT 1 FROM subquery_table WHERE subquery_table.id = main_table.id)</code></pre>
                                </div>
                            </div>
                        </details>
                        
                        <details class="issue" data-severity="medium">
                            <summary>
                                <span class="issue-name">Function in WHERE</span>
                                <span class="severity medium">Medium</span>
                            </summary>
                            <div class="issue-details">
                                <p><strong>Description:</strong> Using functions on columns in WHERE clauses can prevent index usage and slow down queries.</p>
                                <p><strong>Suggestion:</strong> Try to avoid using functions on columns in WHERE clauses.</p>
                                <div class="code-block">
                                    <h4>Offending SQL:</h4>
                                    <pre><code>AND LOWER(p.name)</code></pre>
                                </div>
                                <div class="code-block">
                                    <h4>Context:</h4>
                                    <pre><code>o.status = NULL
  AND p.price BETWEEN 100 AND 500
  AND o.id IN (SELECT id FROM abandoned_orders)
  AND LOWER(p.name) IN ('widget', 'gadget', 'gizmo')
  AND u.created_at > '2022-01-01'
GROUP BY 1, 2, </code></pre>
                                </div>
                                <div class="code-block">
                                    <h4>Remediation example:</h4>
                                    <pre><code>WHERE column = 'value' instead of WHERE LOWER(column) = 'value'</code></pre>
                                </div>
                            </div>
                        </details>
                        
                        <details class="issue" data-severity="medium">
                            <summary>
                                <span class="issue-name">BETWEEN Operator</span>
                                <span class="severity medium">Medium</span>
                            </summary>
                            <div class="issue-details">
                                <p><strong>Description:</strong> Using the BETWEEN operator can result in poor performance for large ranges or complex queries.</p>
                                <p><strong>Suggestion:</strong> Consider using explicit range conditions (e.g., col >= val1 AND col <= val2) for better index utilization.</p>
                                <div class="code-block">
                                    <h4>Offending SQL:</h4>
                                    <pre><code>BETWEEN</code></pre>
                                </div>
                                <div class="code-block">
                                    <h4>Context:</h4>
                                    <pre><code> o.user_id
  AND o.product_id = p.id
  AND u.name LIKE '%john%'
  AND o.status = NULL
  AND p.price BETWEEN 100 AND 500
  AND o.id IN (SELECT id FROM abandoned_orders)
  AND LOWER(p.name) IN ('widget'</code></pre>
                                </div>
                                <div class="code-block">
                                    <h4>Remediation example:</h4>
                                    <pre><code>WHERE column >= value1 AND column <= value2</code></pre>
                                </div>
                            </div>
                        </details>
                        
                    
                        
                        <details class="issue" data-severity="low">
                            <summary>
                                <span class="issue-name">Numeric GROUP BY</span>
                                <span class="severity low">Low</span>
                            </summary>
                            <div class="issue-details">
                                <p><strong>Description:</strong> Using numbers in GROUP BY clauses instead of column names reduces readability and is prone to errors.</p>
                                <p><strong>Suggestion:</strong> Use column names instead of numbers in GROUP BY clauses.</p>
                                <div class="code-block">
                                    <h4>Offending SQL:</h4>
                                    <pre><code>GROUP BY 1, 2, 3
HAVINGCOUNT(*) > 10
ORDER BYRAND()
LIMIT1000;</code></pre>
                                </div>
                                <div class="code-block">
                                    <h4>Context:</h4>
                                    <pre><code>SELECT *
FROM users u, orders o, products p
WHERE u.id = o.user_id
  AND o.product_id = p.id
  AND u.name LIK</code></pre>
                                </div>
                                <div class="code-block">
                                    <h4>Remediation example:</h4>
                                    <pre><code>GROUP BY column1, column2 instead of GROUP BY 1, 2</code></pre>
                                </div>
                            </div>
                        </details>
                        
                    
                    </div>
                </section>
                
                <section class="original-sql">
                    <h2>Original SQL</h2>
                    <pre><code>SELECT *
FROM users u,
     orders o,
     products p
WHERE u.id = o.user_id
  AND o.product_id = p.id
  AND u.name LIKE '%john%'
  AND o.status = NULL
  AND p.price BETWEEN 100 AND 500
  AND o.id IN
    (SELECT id
     FROM abandoned_orders)
  AND LOWER(p.name) IN ('widget',
                        'gadget',
                        'gizmo')
  AND u.created_at > '2022-01-01'
GROUP BY 1,
         2,
         3
HAVING COUNT(*) > 10
ORDER BY RAND()
LIMIT 1000;</code></pre>
                </section>
            </main>
            <script>
                // Create severity distribution chart
                const severityCounts = {"Critical": 2, "High": 2, "Low": 1, "Medium": 4};
                const ctx = document.getElementById('severityChart').getContext('2d');
                
                // Calculate total and percentages
                const total = Object.values(severityCounts).reduce((a, b) => a + b, 0);
                const percentages = Object.fromEntries(
                    Object.entries(severityCounts).map(([key, value]) => [key, ((value / total) * 100).toFixed(1)])
                );

                const chart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Critical', 'High', 'Low', 'Medium'],
                        datasets: [{
                            data: [severityCounts.Critical, severityCounts.High, severityCounts.Low, severityCounts.Medium],
                            backgroundColor: ['#FF0000', '#FFA500', '#008000', '#FFFF00']  // Red, Orange, Green, Yellow
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        const percentage = percentages[label];
                                        return `${label}: ${value} (${percentage}%)`;
                                    }
                                }
                            },
                            datalabels: {
                                formatter: (value, ctx) => {
                                    const label = ctx.chart.data.labels[ctx.dataIndex];
                                    return `${percentages[label]}%`;
                                },
                                color: 'white',
                                font: {
                                    weight: 'bold',
                                    size: 12
                                },
                                textStrokeColor: 'black',
                                textStrokeWidth: 4,
                                textShadowColor: 'black',
                                textShadowBlur: 3,
                            }
                        }
                    },
                    plugins: [ChartDataLabels]
                });

                // Add click event listener to the chart
                
        document.getElementById('severityChart').onclick = function(evt) {
            const activePoints = chart.getElementsAtEventForMode(evt, 'point', chart.options);
            if (activePoints.length > 0) {
                const clickedSeverity = chart.data.labels[activePoints[0].index].toLowerCase();
                filterIssues(clickedSeverity);
            }
        };
        

                function filterIssues(severity) {
                    const issues = document.querySelectorAll('.issue');
                    issues.forEach(issue => {
                        if (severity === 'all' || issue.dataset.severity === severity) {
                            issue.style.display = 'block';
                        } else {
                            issue.style.display = 'none';
                        }
                    });
                }
                
                function toggleBreakdown(breakdownId, summaryBox) {
                    var breakdown = document.getElementById(breakdownId);
                    summaryBox.classList.toggle("active");
                    breakdown.classList.toggle("show");
                }
            </script>
        </body>
        </html>
        