
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>SQL Antipattern Scan Report</title>
            <style>
                /* sql_antipattern_scanner/sql_antipattern_scanner/static/report_styles.css */
:root {
    --primary-color: #3498db;
    --secondary-color: #2c3e50;
    --background-color: #f4f4f4;
    --card-background: #ffffff;
    --text-color: #333333;
    --border-color: #e0e0e0;
    --critical-color: #FF0000;
    --high-color: #FFA500;
    --medium-color: #FFFF00;
    --low-color: #008000;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    color: var(--text-color);
    background-color: var(--background-color);
    margin: 0;
    padding: 0;
}

header {
    background-color: var(--primary-color);
    color: white;
    text-align: center;
    padding: 1rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

main {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
}

h1, h2, h3, h4 {
    color: var(--secondary-color);
}

.summary-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    margin-bottom: 2rem;
    align-items: start;
}

.summary-card {
    background-color: var(--card-background);
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    padding: 1.5rem;
    height: fit-content;
}

.filter-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 1rem;
}

.filter-buttons button {
    background-color: var(--primary-color);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.filter-buttons button:hover,
.filter-buttons button[aria-pressed="true"] {
    background-color: var(--secondary-color);
}

.chart-container {
    height: 400px;
    position: relative;
    width: 100%; /* Add this line to ensure the chart respects its container's width */
}

.issue {
    background-color: var(--card-background);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    margin-bottom: 1rem;
    overflow: hidden;
    transition: box-shadow 0.3s ease;
}

.issue:hover {
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.issue summary {
    padding: 1rem;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #f9f9f9;
    transition: background-color 0.3s ease;
}

.issue summary:hover {
    background-color: #f0f0f0;
}

.issue-name {
    font-weight: bold;
}

.severity {
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: bold;
    text-transform: uppercase;
}

.critical { background-color: var(--critical-color); color: white; }
.high { background-color: var(--high-color); color: black; }
.medium { background-color: var(--medium-color); color: black; }
.low { background-color: var(--low-color); color: white; }

.issue-details {
    padding: 1rem;
}

.code-block {
    background-color: #f0f0f0;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 1rem;
    margin-top: 1rem;
    overflow-x: auto;
}

pre {
    margin: 0;
    white-space: pre-wrap;
    word-wrap: break-word;
}

code {
    font-family: 'Courier New', Courier, monospace;
}

.original-sql pre {
    background-color: #f0f0f0;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 1rem;
    overflow-x: auto;
}

@media (max-width: 768px) {
    .summary-container {
        grid-template-columns: 1fr;
    }
    
    .filter-buttons {
        flex-direction: column;
    }
    
    .filter-buttons button {
        width: 100%;
    }
}

/* Accessibility improvements */
.visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* Focus styles for keyboard navigation */
:focus {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
}

/* Smooth scrolling for anchor links */
html {
    scroll-behavior: smooth;
}

/* Tooltip styles */
.tooltip {
    position: relative;
    display: inline-block;
}

.tooltip .tooltiptext {
    visibility: hidden;
    width: 200px;
    background-color: var(--secondary-color);
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 5px;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    margin-left: -100px;
    opacity: 0;
    transition: opacity 0.3s;
}

.tooltip:hover .tooltiptext {
    visibility: visible;
    opacity: 1;
}

/* Print styles */
@media print {
    body {
        background-color: white;
    }

    .filter-buttons,
    .chart-container {
        display: none;
    }

    .issue {
        break-inside: avoid;
    }

    .code-block {
        white-space: pre-wrap;
        word-wrap: break-word;
    }
}

.chart-card {
    width: 100%;
    max-width: 600px; /* Add this line to limit the maximum width */
    background-color: var(--card-background);
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    padding: 1.5rem;
}

.summary-box {
    cursor: pointer;
    border: 1px solid #ddd;
    padding: 10px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #f9f9f9;
    border-radius: 4px;
}

.summary-box:hover {
    background-color: #f0f0f0;
}

.summary-box.active .toggle-icon {
    transform: rotate(180deg);
}

.large-number {
    font-size: 2em;
    font-weight: bold;
    margin: 0;
}

.toggle-icon {
    font-size: 1.2em;
    transition: transform 0.3s ease;
}

.breakdown {
    display: none;
    margin-top: 10px;
    padding: 10px;
    border: 1px solid #ddd;
    background-color: #f9f9f9;
    border-radius: 4px;
}

h2, h3 {
    margin-top: 0;
    margin-bottom: 1rem;
}
            </style>
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        </head>
        <body>
            <header>
                <h1>SQL Antipattern Scan Report</h1>
            </header>
            <main>
                <h2>Summary</h2>
                <div class="summary-container">
                    <div class="summary-card">
                        <h3>Total Issues</h3>
                        <div class="summary-box" data-target="total-issues-breakdown">
                            <p class="large-number">9</p>
                            <span class="toggle-icon">&#9662;</span>
                        </div>
                        <div id="total-issues-breakdown" class="breakdown" style="display: none;">
                            <h4>Issues Breakdown</h4>
                            <ul>
                                
                                <li>Critical: 2</li>
                                
                                <li>High: 2</li>
                                
                                <li>Medium: 4</li>
                                
                                <li>Low: 1</li>
                                
                            </ul>
                        </div>
                        <h3>Severity Score</h3>
                        <div class="summary-box" data-target="severity-score-breakdown">
                            <p class="large-number">23</p>
                            <span class="toggle-icon">&#9662;</span>
                        </div>
                        <div id="severity-score-breakdown" class="breakdown" style="display: none;">
                            <h4>Score Calculation</h4>
                            <p>The severity score is calculated based on the number and severity of issues found.</p>
                            <ul>
                                <li>Critical: 4 points</li>
                                <li>High: 3 points</li>
                                <li>Medium: 2 points</li>
                                <li>Low: 1 point</li>
                            </ul>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>Severity Distribution</h3>
                        <div class="chart-container">
                            <canvas id="severityChart"></canvas>
                        </div>
                    </div>
                </div>
                <section class="detailed-findings">
                    <h2>Detailed Findings</h2>
                    
                    <details class="issue" data-severity="critical">
                        <summary onclick="toggleDetails(this)" aria-expanded="false">
                            <span class="issue-name">ANSI-89 Join</span>
                            <span class="severity critical">Critical</span>
                        </summary>
                        <div class="issue-details">
                            <p><strong>Description:</strong> Using outdated ANSI-89 join syntax instead of explicit JOIN clauses can lead to logical errors and reduced readability.</p>
                            <p><strong>Suggestion:</strong> Use explicit JOIN clauses instead of comma-separated table lists.</p>
                            <div class="code-block">
                                <h4>Offending SQL:</h4>
                                <pre><code>users u, orders o, products p</code></pre>
                            </div>
                            <div class="code-block">
                                <h4>Context:</h4>
                                <pre><code>FROM users u, orders o, products p
WHERE u.id = o.user_id
  AND o.product_id = p.id
  AND u.name LIKE '%john%'
  AND o.status = NULL
  AND p.price BETWEEN 100 AND 500
  AND o.id IN (SELECT id FROM abandoned_orders)
  AND LOWER(p.name) IN ('widget', 'gadget', 'gizmo')
  AND u.created_at > '2022-01-01'
GROUP BY</code></pre>
                            </div>
                            <p><strong>Remediation:</strong> FROM table1 INNER JOIN table2 ON table1.id = table2.id</p>
                        </div>
                    </details>
                    
                    <details class="issue" data-severity="critical">
                        <summary onclick="toggleDetails(this)" aria-expanded="false">
                            <span class="issue-name">NULL Comparison</span>
                            <span class="severity critical">Critical</span>
                        </summary>
                        <div class="issue-details">
                            <p><strong>Description:</strong> Incorrectly filtering for NULL using = or != instead of IS NULL or IS NOT NULL.</p>
                            <p><strong>Suggestion:</strong> Use IS NULL or IS NOT NULL for NULL comparisons.</p>
                            <div class="code-block">
                                <h4>Offending SQL:</h4>
                                <pre><code>o.status = NULL</code></pre>
                            </div>
                            <div class="code-block">
                                <h4>Context:</h4>
                                <pre><code>SELECT *
FROM users u, orders o, products p
WHERE u.id = o.user_id
  AND o.product_id = p.id
  AND u.name LI</code></pre>
                            </div>
                            <p><strong>Remediation:</strong> WHERE column IS NULL</p>
                        </div>
                    </details>
                    
                    <details class="issue" data-severity="high">
                        <summary onclick="toggleDetails(this)" aria-expanded="false">
                            <span class="issue-name">ORDER BY RAND()</span>
                            <span class="severity high">High</span>
                        </summary>
                        <div class="issue-details">
                            <p><strong>Description:</strong> Using ORDER BY RAND() for random sorting is inefficient for large datasets.</p>
                            <p><strong>Suggestion:</strong> Consider alternative methods for random selection, such as using a subquery with LIMIT.</p>
                            <div class="code-block">
                                <h4>Offending SQL:</h4>
                                <pre><code>ORDER BY RAND()</code></pre>
                            </div>
                            <div class="code-block">
                                <h4>Context:</h4>
                                <pre><code>widget', 'gadget', 'gizmo')
  AND u.created_at > '2022-01-01'
GROUP BY 1, 2, 3
HAVING COUNT(*) > 10
ORDER BY RAND()
LIMIT 1000;</code></pre>
                            </div>
                            <p><strong>Remediation:</strong> SELECT * FROM (SELECT * FROM table ORDER BY RAND() LIMIT 10) t ORDER BY id</p>
                        </div>
                    </details>
                    
                    <details class="issue" data-severity="high">
                        <summary onclick="toggleDetails(this)" aria-expanded="false">
                            <span class="issue-name">Both-sided Wildcard</span>
                            <span class="severity high">High</span>
                        </summary>
                        <div class="issue-details">
                            <p><strong>Description:</strong> Using wildcards on both sides in LIKE conditions can lead to poor performance and ineffective index usage.</p>
                            <p><strong>Suggestion:</strong> Avoid using both leading and trailing wildcards in LIKE conditions. Consider full-text search for complex pattern matching.</p>
                            <div class="code-block">
                                <h4>Offending SQL:</h4>
                                <pre><code>LIKE '%john%'</code></pre>
                            </div>
                            <div class="code-block">
                                <h4>Context:</h4>
                                <pre><code> *
FROM users u, orders o, products p
WHERE u.id = o.user_id
  AND o.product_id = p.id
  AND u.name LIKE '%john%'
  AND o.status = NULL
  AND p.price BETWEEN 100 AND 500
  AND o.id IN (SELECT id FROM </code></pre>
                            </div>
                            <p><strong>Remediation:</strong> Use a full-text search index or LIKE 'value%' if possible</p>
                        </div>
                    </details>
                    
                    <details class="issue" data-severity="medium">
                        <summary onclick="toggleDetails(this)" aria-expanded="false">
                            <span class="issue-name">SELECT *</span>
                            <span class="severity medium">Medium</span>
                        </summary>
                        <div class="issue-details">
                            <p><strong>Description:</strong> Using SELECT * instead of specifying columns can lead to performance issues and make queries brittle to schema changes.</p>
                            <p><strong>Suggestion:</strong> Explicitly list the columns you need in the SELECT statement.</p>
                            <div class="code-block">
                                <h4>Offending SQL:</h4>
                                <pre><code>SELECT *</code></pre>
                            </div>
                            <div class="code-block">
                                <h4>Context:</h4>
                                <pre><code>SELECT *
FROM users u, orders o, products p
WHERE u.id = o.user_id
  AND o.product_id = p.id
  AND u.n</code></pre>
                            </div>
                            <p><strong>Remediation:</strong> SELECT column1, column2, column3 FROM table</p>
                        </div>
                    </details>
                    
                    <details class="issue" data-severity="medium">
                        <summary onclick="toggleDetails(this)" aria-expanded="false">
                            <span class="issue-name">Subquery in IN clause</span>
                            <span class="severity medium">Medium</span>
                        </summary>
                        <div class="issue-details">
                            <p><strong>Description:</strong> Using a subquery in an IN clause can be inefficient. Consider using EXISTS or JOIN instead.</p>
                            <p><strong>Suggestion:</strong> Replace IN (SELECT ...) with EXISTS or JOIN for better performance.</p>
                            <div class="code-block">
                                <h4>Offending SQL:</h4>
                                <pre><code>WHERE u.id = o.user_id
  AND o.product_id = p.id
  AND u.name LIKE '%john%'
  AND o.status = NULL
  AND p.price BETWEEN 100 AND 500
  AND o.id IN (SELECT id FROM abandoned_orders)
  AND LOWER(p.name) IN ('widget', 'gadget', 'gizmo')
  AND u.created_at > '2022-01-01'
</code></pre>
                            </div>
                            <div class="code-block">
                                <h4>Context:</h4>
                                <pre><code>SELECT *
FROM users u, orders o, products p
WHERE u.id = o.user_id
  AND o.product_id = p.id
  AND u.name LI</code></pre>
                            </div>
                            <p><strong>Remediation:</strong> WHERE EXISTS (SELECT 1 FROM subquery_table WHERE subquery_table.id = main_table.id)</p>
                        </div>
                    </details>
                    
                    <details class="issue" data-severity="medium">
                        <summary onclick="toggleDetails(this)" aria-expanded="false">
                            <span class="issue-name">Function in WHERE</span>
                            <span class="severity medium">Medium</span>
                        </summary>
                        <div class="issue-details">
                            <p><strong>Description:</strong> Using functions on columns in WHERE clauses can prevent index usage and slow down queries.</p>
                            <p><strong>Suggestion:</strong> Try to avoid using functions on columns in WHERE clauses.</p>
                            <div class="code-block">
                                <h4>Offending SQL:</h4>
                                <pre><code>AND LOWER(p.name)</code></pre>
                            </div>
                            <div class="code-block">
                                <h4>Context:</h4>
                                <pre><code>o.status = NULL
  AND p.price BETWEEN 100 AND 500
  AND o.id IN (SELECT id FROM abandoned_orders)
  AND LOWER(p.name) IN ('widget', 'gadget', 'gizmo')
  AND u.created_at > '2022-01-01'
GROUP BY 1, 2, </code></pre>
                            </div>
                            <p><strong>Remediation:</strong> WHERE column = 'value' instead of WHERE LOWER(column) = 'value'</p>
                        </div>
                    </details>
                    
                    <details class="issue" data-severity="medium">
                        <summary onclick="toggleDetails(this)" aria-expanded="false">
                            <span class="issue-name">BETWEEN Operator</span>
                            <span class="severity medium">Medium</span>
                        </summary>
                        <div class="issue-details">
                            <p><strong>Description:</strong> Using the BETWEEN operator can result in poor performance for large ranges or complex queries.</p>
                            <p><strong>Suggestion:</strong> Consider using explicit range conditions (e.g., col >= val1 AND col <= val2) for better index utilization.</p>
                            <div class="code-block">
                                <h4>Offending SQL:</h4>
                                <pre><code>BETWEEN</code></pre>
                            </div>
                            <div class="code-block">
                                <h4>Context:</h4>
                                <pre><code> o.user_id
  AND o.product_id = p.id
  AND u.name LIKE '%john%'
  AND o.status = NULL
  AND p.price BETWEEN 100 AND 500
  AND o.id IN (SELECT id FROM abandoned_orders)
  AND LOWER(p.name) IN ('widget'</code></pre>
                            </div>
                            <p><strong>Remediation:</strong> WHERE column >= value1 AND column <= value2</p>
                        </div>
                    </details>
                    
                    <details class="issue" data-severity="low">
                        <summary onclick="toggleDetails(this)" aria-expanded="false">
                            <span class="issue-name">Numeric GROUP BY</span>
                            <span class="severity low">Low</span>
                        </summary>
                        <div class="issue-details">
                            <p><strong>Description:</strong> Using numbers in GROUP BY clauses instead of column names reduces readability and is prone to errors.</p>
                            <p><strong>Suggestion:</strong> Use column names instead of numbers in GROUP BY clauses.</p>
                            <div class="code-block">
                                <h4>Offending SQL:</h4>
                                <pre><code>GROUP BY 1, 2, 3
HAVINGCOUNT(*) > 10
ORDER BYRAND()
LIMIT1000;</code></pre>
                            </div>
                            <div class="code-block">
                                <h4>Context:</h4>
                                <pre><code>SELECT *
FROM users u, orders o, products p
WHERE u.id = o.user_id
  AND o.product_id = p.id
  AND u.name LIK</code></pre>
                            </div>
                            <p><strong>Remediation:</strong> GROUP BY column1, column2 instead of GROUP BY 1, 2</p>
                        </div>
                    </details>
                    
                </section>
                <section class="original-sql">
                    <h2>Original SQL</h2>
                    <pre><code>SELECT *
FROM users u,
     orders o,
     products p
WHERE u.id = o.user_id
  AND o.product_id = p.id
  AND u.name LIKE '%john%'
  AND o.status = NULL
  AND p.price BETWEEN 100 AND 500
  AND o.id IN
    (SELECT id
     FROM abandoned_orders)
  AND LOWER(p.name) IN ('widget',
                        'gadget',
                        'gizmo')
  AND u.created_at > '2022-01-01'
GROUP BY 1,
         2,
         3
HAVING COUNT(*) > 10
ORDER BY RAND()
LIMIT 1000;</code></pre>
                </section>
            </main>
            <script>
                
        function filterIssues(severity) {
            const issues = document.querySelectorAll('.issue');
            issues.forEach(issue => {
                if (severity === 'all' || issue.dataset.severity === severity) {
                    issue.style.display = 'block';
                } else {
                    issue.style.display = 'none';
                }
            });

            // Update active state of filter buttons if they exist
            const buttons = document.querySelectorAll('.filter-buttons button');
            buttons.forEach(button => {
                button.classList.toggle('active', button.textContent.toLowerCase() === severity);
            });
        }

        function toggleDetails(element) {
            const details = element.nextElementSibling;
            details.style.display = details.style.display === 'none' ? 'block' : 'none';
            element.setAttribute('aria-expanded', details.style.display === 'block');
        }
        
                const ctx = document.getElementById('severityChart').getContext('2d');
                const chart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Critical', 'High', 'Medium', 'Low'],
                        datasets: [{
                            data: [2, 2, 4, 1],
                            backgroundColor: ['#FF0000', '#FFA500', '#FFFF00', '#008000']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed || 0;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = Math.round((value / total) * 100);
                                        return `${label}: ${value} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });

                // Restore chart click filtering
                chart.canvas.onclick = function(evt) {
                    const activePoints = chart.getElementsAtEventForMode(evt, 'point', chart.options);
                    if (activePoints.length > 0) {
                        const clickedSeverity = chart.data.labels[activePoints[0].index].toLowerCase();
                        filterIssues(clickedSeverity);
                    }
                };
                
                // Dropdown toggle function
                document.addEventListener('DOMContentLoaded', function() {
                    const summaryBoxes = document.querySelectorAll('.summary-box');
                    summaryBoxes.forEach(box => {
                        box.addEventListener('click', function() {
                            const breakdownId = this.getAttribute('data-target');
                            const breakdown = document.getElementById(breakdownId);
                            breakdown.style.display = breakdown.style.display === 'none' ? 'block' : 'none';
                            this.classList.toggle('active');
                        });
                    });
                });

                // Filter issues function
                function filterIssues(severity) {
                    const issues = document.querySelectorAll('.issue');
                    issues.forEach(issue => {
                        if (severity === 'all' || issue.dataset.severity === severity) {
                            issue.style.display = 'block';
                        } else {
                            issue.style.display = 'none';
                        }
                    });

                    // Update active state of filter buttons if they exist
                    const buttons = document.querySelectorAll('.filter-buttons button');
                    buttons.forEach(button => {
                        button.classList.toggle('active', button.textContent.toLowerCase() === severity);
                    });
                }
            </script>
        </body>
        </html>
        